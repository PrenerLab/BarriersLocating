---
title: "Barrier Checks"
output: html_notebook
---

# Dependencies 

This notebooke requires the following packages:

```{r, warning=FALSE}
library(dplyr)
library(rgdal)
library(broom)
```

# Import Data

The raw data come from two tables (location data for each barrier and google maps verification data for each barrier) as well as a shapefile of all barriers we've geocoded to date:

```{r, warning=FALSE}
# import tabular data
barrierDates  <- read.csv("barrierDates.csv", stringsAsFactors = FALSE)
barrierVerify <- read.csv("barriersVerify.csv", stringsAsFactors = FALSE)

# change working directory for remainder of code chunk (will reset at end of chunk)
setwd('..')
setwd("spatialData")

# import spatial data
barrierGeo    <- readOGR(dsn = ".", layer = "MergedShapefile")

# convert spatial data to data frame
barrierGeo    <- tidy(barrierGeo)
```

# Combine Data Sources

To faciliate the join below, we need to rename the identification barrier in `barrierGeo` from `BarrierID` to `id`:

```{r}
barrierGeo <- rename(barrierGeo, id = BarrierID)
```

In order to check these data to identify barriers that we have not yet geocoded, all of the raw data are joined together:

```{r}
barrierChecks <- left_join(barrierDates, barrierVerify, by = "id")
barrierChecks <- left_join(barrierChecks, barrierGeo, by = "id")
```

# Check for Missing Barriers in Spatial Data

This section executes a logic test on the joined data, looking for observations that are missing x or y coordinates. When those observations are found, they are piped into a new data frame named `barrierFail`:

```{r}
barrierChecks$check <- ifelse(is.na(barrierChecks$coords.x1) == TRUE | 
                              is.na(barrierChecks$coords.x2) == TRUE, 
                              "fail", "pass")

barrierFail <- barrierChecks %>%
  filter(check == "fail")

write.csv(barrierFail, "barriersMissing.csv")
```

```{r}
barrierPass <- barrierChecks %>%
  filter(check == "pass")

write.csv(barrierPass, "barriersPass.csv")
```

